---
 - name: create_rhel_vm
   hosts: localhost
   become: yes
   vars:
     vm_name: 'rhel-demo'
     aws_region: 'us-east-2'
     aws_keypair_name: 'EDA-KEY'
     aws_vpc_subnet_name: 'AAP-subnet-public1-us-east-2a'
     aws_security_group_name: 'RedHat-SG'
     vm_blueprint: 'rhel8'
     
   vars_files:
     - "vm_blueprints/{{ vm_blueprint }}.yml"

   tasks:
     - name: start an instance with a public IP address
       amazon.aws.ec2_instance:
         name: '{{ vm_name }}'
         key_name: '{{ aws_keypair_name }}'
         vpc_subnet_id: '{{ aws_vpc_subnet_name }}'
         instance_type: '{{ aws_instance_size }}'
         security_group: '{{ aws_security_group_name }}'
         network:
         assign_public_ip: true
         image_id: '{{ aws_image_filter }}'
         tags:
           Environment: DEMO
           Name: '{{ vm_name }}'
